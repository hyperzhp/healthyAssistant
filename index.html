<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººå¥åº·æ´»åŠ¨è¿½è¸ªå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .tab.active {
            background: #4facfe;
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .stat-card h4 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4facfe;
        }

        .history-item .date {
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 5px;
        }

        .history-item .note {
            color: #666;
            font-style: italic;
        }

        .reminder-card {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .health-tip {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d3436;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                margin-bottom: 5px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ ä¸ªäººå¥åº·æ´»åŠ¨è¿½è¸ªå™¨</h1>
            <p>ç§‘å­¦è®°å½•ï¼Œå¥åº·åˆ†æï¼Œæ™ºèƒ½æé†’</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('record')">ğŸ“ è®°å½•</button>
                <button class="tab" onclick="switchTab('stats')">ğŸ“Š ç»Ÿè®¡</button>
                <button class="tab" onclick="switchTab('analysis')">ğŸ” åˆ†æ</button>
                <button class="tab" onclick="switchTab('reminders')">â° æé†’</button>
                <button class="tab" onclick="switchTab('history')">ğŸ“‹ å†å²</button>
                <button class="tab" onclick="switchTab('settings')">âš™ï¸ è®¾ç½®</button>
            </div>

            <!-- è®°å½•æ ‡ç­¾é¡µ -->
            <div id="record" class="tab-content active">
                <!-- åœ¨â€œè®°å½•æ ‡ç­¾é¡µâ€formä¸‹æ–¹æ’å…¥ -->
                <div class="card" id="nofapCard">
                    <h3>ğŸš« æˆ’è‰²æ‰“å¡</h3>
                    <p>å·²è¿ç»­ <span id="nofapStreak">0</span> å¤©æœªç ´æˆ’</p>
                    <button class="btn" id="nofapBtn" onclick="noFapCheckIn()">ä»Šæ—¥æ‰“å¡</button>
                    <button class="btn btn-danger" id="nofapCancelBtn" onclick="noFapCancelCheckIn()"
                        style="margin-left:10px;">å–æ¶ˆæ‰“å¡</button>
                </div>
                <!-- å¯æ”¾åœ¨æˆ’è‰²æ‰“å¡å¡ç‰‡ä¸‹æ–¹ -->
                <div class="card" id="nofapCalendarCard">
                    <h3>ğŸ“… æˆ’è‰²æ‰“å¡æ—¥å†</h3>
                    <div id="nofapCalendar"></div>
                </div>
                <div class="card">
                    <h3>ğŸ†• æ·»åŠ æ–°è®°å½•</h3>
                    <div class="input-group">
                        <label>æ—¥æœŸæ—¶é—´ï¼š</label>
                        <input type="datetime-local" id="recordDateTime">
                    </div>
                    <div class="input-group">
                        <label>æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
                        <input type="number" id="duration" placeholder="ä¾‹å¦‚ï¼š15" min="1" max="300">
                    </div>
                    <div class="input-group">
                        <label>å¿ƒæƒ…è¯„åˆ†ï¼ˆ1-10ï¼‰ï¼š</label>
                        <input type="range" id="mood" min="1" max="10" value="5">
                        <span id="moodValue">5</span>
                    </div>
                    <div class="input-group">
                        <label>èº«ä½“çŠ¶æ€ï¼š</label>
                        <select id="physicalState">
                            <option value="excellent">æä½³</option>
                            <option value="good" selected>è‰¯å¥½</option>
                            <option value="normal">ä¸€èˆ¬</option>
                            <option value="tired">ç–²åŠ³</option>
                            <option value="stressed">å‹åŠ›å¤§</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>å¤‡æ³¨ï¼š</label>
                        <textarea id="notes" placeholder="è®°å½•ä»»ä½•æƒ³è¦å¤‡æ³¨çš„å†…å®¹..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="addRecord()">âœ… æ·»åŠ è®°å½•</button>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ ‡ç­¾é¡µ -->
            <div id="stats" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4 id="todayCount">0</h4>
                        <p>ä»Šæ—¥æ¬¡æ•°</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="weekCount">0</h4>
                        <p>æœ¬å‘¨æ¬¡æ•°</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="monthCount">0</h4>
                        <p>æœ¬æœˆæ¬¡æ•°</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="avgWeekly">0</h4>
                        <p>å‘¨å¹³å‡æ¬¡æ•°</p>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>ğŸ“ˆ ä¸ƒå¤©è¶‹åŠ¿å›¾</h3>
                    <canvas id="weeklyChart" width="400" height="200"></canvas>
                </div>

                <div class="chart-container">
                    <h3>â° æ—¶é—´åˆ†å¸ƒ</h3>
                    <div id="timeDistribution"></div>
                </div>
            </div>

            <!-- åˆ†ææ ‡ç­¾é¡µ -->
            <div id="analysis" class="tab-content">
                <div class="card">
                    <h3>ğŸ” å¥åº·åˆ†ææŠ¥å‘Š</h3>
                    <div id="healthAnalysis">
                        <p>æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–å¥åº·åˆ†æ...</p>
                    </div>
                </div>

                <div class="health-tip">
                    <h3>ğŸ’¡ å¥åº·å»ºè®®</h3>
                    <div id="healthTips">
                        <p>â€¢ é€‚åº¦çš„è‡ªæˆ‘æ¢ç´¢æ˜¯æ­£å¸¸å’Œå¥åº·çš„</p>
                        <p>â€¢ ä¿æŒè‰¯å¥½çš„ä¸ªäººå«ç”Ÿä¹ æƒ¯</p>
                        <p>â€¢ æ³¨æ„é¢‘ç‡ï¼Œé¿å…è¿‡åº¦</p>
                        <p>â€¢ å¦‚æœ‰æ‹…å¿§ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ</p>
                    </div>
                </div>
            </div>

            <!-- æé†’æ ‡ç­¾é¡µ -->
            <div id="reminders" class="tab-content">
                <div class="card">
                    <h3>â° è®¾ç½®æé†’</h3>
                    <div class="input-group">
                        <label>é¢‘ç‡æé†’ï¼š</label>
                        <select id="frequencyReminder">
                            <option value="none">æ— æé†’</option>
                            <option value="daily">æ¯æ—¥æ£€æŸ¥</option>
                            <option value="weekly">æ¯å‘¨æ€»ç»“</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>å¥åº·æé†’æ—¶é—´ï¼š</label>
                        <input type="time" id="reminderTime" value="20:00">
                    </div>
                    <button class="btn" onclick="setReminder()">ğŸ’¾ ä¿å­˜æé†’è®¾ç½®</button>
                </div>

                <div class="reminder-card">
                    <h3>ğŸ”” å½“å‰æé†’</h3>
                    <div id="currentReminders">
                        <p>æš‚æ— æ´»åŠ¨æé†’</p>
                    </div>
                </div>
            </div>

            <!-- å†å²è®°å½•æ ‡ç­¾é¡µ -->
            <div id="history" class="tab-content">
                <div class="card">
                    <h3>ğŸ“‹ å†å²è®°å½•</h3>
                    <div class="input-group">
                        <label>ç­›é€‰æ—¥æœŸï¼š</label>
                        <input type="date" id="filterDate" onchange="filterHistory()">
                    </div>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
                    <div id="historyList">
                        <p>æš‚æ— è®°å½•</p>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
            <div id="settings" class="tab-content">
                <div class="card">
                    <h3>âš™ï¸ åº”ç”¨è®¾ç½®</h3>
                    <div class="input-group">
                        <label>æ•°æ®å¯¼å‡ºï¼š</label>
                        <button class="btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®å¯¼å…¥ï¼š</label>
                        <input type="file" id="importFile" accept=".json">
                        <button class="btn" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    </div>
                    <div class="input-group">
                        <label>éšç§è®¾ç½®ï¼š</label>
                        <p style="color: #666; font-size: 0.9rem;">æ‰€æœ‰æ•°æ®ä»…å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨ï¼ˆä½¿ç”¨å†…å­˜å­˜å‚¨ï¼‰
        let healthData = {
            records: [],
            settings: {
                reminderTime: '20:00',
                frequencyReminder: 'none'
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
        });

        function initializeApp() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            document.getElementById('recordDateTime').value = formatDateTimeLocal(now);

            // åˆå§‹åŒ–å¿ƒæƒ…æ»‘å—
            const moodSlider = document.getElementById('mood');
            const moodValue = document.getElementById('moodValue');
            moodSlider.addEventListener('input', function () {
                moodValue.textContent = this.value;
            });

            updateStats();
            updateHistory();
        }

        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // å¦‚æœåˆ‡æ¢åˆ°ç»Ÿè®¡é¡µé¢ï¼Œæ›´æ–°å›¾è¡¨
            if (tabName === 'stats') {
                setTimeout(updateCharts, 100);
            }

            // å¦‚æœåˆ‡æ¢åˆ°åˆ†æé¡µé¢ï¼Œæ›´æ–°åˆ†æ
            if (tabName === 'analysis') {
                updateAnalysis();
            }
        }

        function addRecord() {
            const dateTime = document.getElementById('recordDateTime').value;
            const duration = parseInt(document.getElementById('duration').value);
            const mood = parseInt(document.getElementById('mood').value);
            const physicalState = document.getElementById('physicalState').value;
            const notes = document.getElementById('notes').value;

            if (!dateTime || !duration) {
                alert('è¯·å¡«å†™å¿…è¦çš„ä¿¡æ¯ï¼ˆæ—¥æœŸæ—¶é—´å’ŒæŒç»­æ—¶é—´ï¼‰');
                return;
            }

            const record = {
                id: Date.now(),
                dateTime: dateTime,
                duration: duration,
                mood: mood,
                physicalState: physicalState,
                notes: notes,
                timestamp: new Date().toISOString()
            };

            healthData.records.push(record);

            // æ¸…ç©ºè¡¨å•
            document.getElementById('duration').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('mood').value = 5;
            document.getElementById('moodValue').textContent = '5';
            document.getElementById('physicalState').value = 'good';

            // é‡æ–°è®¾ç½®ä¸ºå½“å‰æ—¶é—´
            document.getElementById('recordDateTime').value = formatDateTimeLocal(new Date());

            updateStats();
            updateHistory();

            alert('è®°å½•æ·»åŠ æˆåŠŸï¼');
        }

        function updateStats() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

            let todayCount = 0;
            let weekCount = 0;
            let monthCount = 0;

            healthData.records.forEach(record => {
                const recordDate = new Date(record.dateTime);
                const recordDay = new Date(recordDate.getFullYear(), recordDate.getMonth(), recordDate.getDate());

                if (recordDay.getTime() === today.getTime()) {
                    todayCount++;
                }
                if (recordDate >= weekStart) {
                    weekCount++;
                }
                if (recordDate >= monthStart) {
                    monthCount++;
                }
            });

            // è®¡ç®—å‘¨å¹³å‡
            const weeksSinceStart = healthData.records.length > 0 ?
                Math.max(1, Math.ceil((now - new Date(healthData.records[0].dateTime)) / (7 * 24 * 60 * 60 * 1000))) : 1;
            const avgWeekly = (healthData.records.length / weeksSinceStart).toFixed(1);

            document.getElementById('todayCount').textContent = todayCount;
            document.getElementById('weekCount').textContent = weekCount;
            document.getElementById('monthCount').textContent = monthCount;
            document.getElementById('avgWeekly').textContent = avgWeekly;
        }

        function updateCharts() {
            updateWeeklyChart();
            updateTimeDistribution();
        }

        function updateWeeklyChart() {
            const canvas = document.getElementById('weeklyChart');
            const ctx = canvas.getContext('2d');

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // è·å–æœ€è¿‘7å¤©çš„æ•°æ®
            const last7Days = [];
            const now = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(now.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];

                const count = healthData.records.filter(record =>
                    record.dateTime.startsWith(dateStr)
                ).length;

                last7Days.push({
                    date: date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }),
                    count: count
                });
            }

            // ç»˜åˆ¶å›¾è¡¨
            const maxCount = Math.max(...last7Days.map(d => d.count), 1);
            const chartHeight = canvas.height - 60;
            const chartWidth = canvas.width - 60;
            const barWidth = chartWidth / 7;

            ctx.fillStyle = '#4facfe';
            last7Days.forEach((day, index) => {
                const barHeight = (day.count / maxCount) * chartHeight;
                const x = 30 + index * barWidth + barWidth * 0.2;
                const y = canvas.height - 30 - barHeight;

                ctx.fillRect(x, y, barWidth * 0.6, barHeight);

                // ç»˜åˆ¶æ ‡ç­¾
                ctx.fillStyle = '#333';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(day.date, x + barWidth * 0.3, canvas.height - 10);
                ctx.fillText(day.count, x + barWidth * 0.3, y - 5);
                ctx.fillStyle = '#4facfe';
            });
        }

        function updateTimeDistribution() {
            const timeSlots = {
                'æ—©æ™¨ (6-12)': 0,
                'ä¸‹åˆ (12-18)': 0,
                'æ™šä¸Š (18-24)': 0,
                'æ·±å¤œ (0-6)': 0
            };

            healthData.records.forEach(record => {
                const hour = new Date(record.dateTime).getHours();
                if (hour >= 6 && hour < 12) timeSlots['æ—©æ™¨ (6-12)']++;
                else if (hour >= 12 && hour < 18) timeSlots['ä¸‹åˆ (12-18)']++;
                else if (hour >= 18 && hour < 24) timeSlots['æ™šä¸Š (18-24)']++;
                else timeSlots['æ·±å¤œ (0-6)']++;
            });

            const total = Object.values(timeSlots).reduce((a, b) => a + b, 0);
            const container = document.getElementById('timeDistribution');

            container.innerHTML = '';
            Object.entries(timeSlots).forEach(([period, count]) => {
                const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;

                const div = document.createElement('div');
                div.style.marginBottom = '15px';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${period}</span>
                        <span>${count}æ¬¡ (${percentage}%)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateAnalysis() {
            const totalRecords = healthData.records.length;
            const last30Days = healthData.records.filter(record =>
                (new Date() - new Date(record.dateTime)) <= 30 * 24 * 60 * 60 * 1000
            );

            const avgMood = last30Days.length > 0 ?
                (last30Days.reduce((sum, record) => sum + record.mood, 0) / last30Days.length).toFixed(1) : 0;

            const avgDuration = last30Days.length > 0 ?
                (last30Days.reduce((sum, record) => sum + record.duration, 0) / last30Days.length).toFixed(1) : 0;

            const monthlyFreq = last30Days.length;
            const weeklyFreq = (monthlyFreq / 4.3).toFixed(1);

            let analysis = `
                <div style="line-height: 1.8;">
                    <h4>ğŸ“Š åŸºç¡€æ•°æ®æ¦‚è§ˆ</h4>
                    <p>â€¢ æ€»è®°å½•æ•°ï¼š<strong>${totalRecords}</strong> æ¬¡</p>
                    <p>â€¢ è¿‘30å¤©é¢‘ç‡ï¼š<strong>${monthlyFreq}</strong> æ¬¡ï¼ˆå‘¨å¹³å‡ ${weeklyFreq} æ¬¡ï¼‰</p>
                    <p>â€¢ å¹³å‡å¿ƒæƒ…è¯„åˆ†ï¼š<strong>${avgMood}/10</strong></p>
                    <p>â€¢ å¹³å‡æŒç»­æ—¶é—´ï¼š<strong>${avgDuration}</strong> åˆ†é’Ÿ</p>
                    
                    <h4 style="margin-top: 25px;">ğŸ¥ å¥åº·è¯„ä¼°</h4>
            `;

            // é¢‘ç‡è¯„ä¼°
            if (weeklyFreq < 1) {
                analysis += '<p>â€¢ é¢‘ç‡ï¼šè¾ƒä½ï¼Œå±äºæ­£å¸¸èŒƒå›´</p>';
            } else if (weeklyFreq <= 3) {
                analysis += '<p>â€¢ é¢‘ç‡ï¼šæ­£å¸¸ï¼Œç¬¦åˆå¥åº·æ ‡å‡†</p>';
            } else if (weeklyFreq <= 7) {
                analysis += '<p>â€¢ é¢‘ç‡ï¼šç¨é«˜ï¼Œæ³¨æ„é€‚åº¦</p>';
            } else {
                analysis += '<p>â€¢ é¢‘ç‡ï¼šè¾ƒé«˜ï¼Œå»ºè®®é€‚å½“å‡å°‘</p>';
            }

            // å¿ƒæƒ…è¯„ä¼°
            if (avgMood >= 7) {
                analysis += '<p>â€¢ å¿ƒç†çŠ¶æ€ï¼šè‰¯å¥½ï¼Œæƒ…ç»ªç§¯æ</p>';
            } else if (avgMood >= 5) {
                analysis += '<p>â€¢ å¿ƒç†çŠ¶æ€ï¼šä¸€èˆ¬ï¼Œæƒ…ç»ªç¨³å®š</p>';
            } else {
                analysis += '<p>â€¢ å¿ƒç†çŠ¶æ€ï¼šéœ€è¦å…³æ³¨ï¼Œå»ºè®®å¯»æ±‚æ”¯æŒ</p>';
            }

            analysis += `
                    <h4 style="margin-top: 25px;">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h4>
                    <p>â€¢ ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´</p>
                    <p>â€¢ æ³¨æ„ä¸ªäººå«ç”Ÿå’Œæ¸…æ´</p>
                    <p>â€¢ é€‚åº¦è¿åŠ¨ï¼Œä¿æŒèº«å¿ƒå¥åº·</p>
                    <p>â€¢ å¦‚æœ‰ä»»ä½•æ‹…å¿§ï¼ŒåŠæ—¶å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ</p>
                </div>
            `;

            document.getElementById('healthAnalysis').innerHTML = analysis;
        }

        function updateHistory() {
            const historyList = document.getElementById('historyList');

            if (healthData.records.length === 0) {
                historyList.innerHTML = '<p>æš‚æ— è®°å½•</p>';
                return;
            }

            const sortedRecords = [...healthData.records].sort((a, b) =>
                new Date(b.dateTime) - new Date(a.dateTime)
            );

            historyList.innerHTML = sortedRecords.map(record => `
                <div class="history-item">
                    <div class="date">${new Date(record.dateTime).toLocaleString('zh-CN')}</div>
                    <div>æŒç»­æ—¶é—´ï¼š${record.duration}åˆ†é’Ÿ | å¿ƒæƒ…ï¼š${record.mood}/10 | çŠ¶æ€ï¼š${getStateText(record.physicalState)}</div>
                    ${record.notes ? `<div class="note">${record.notes}</div>` : ''}
                    <button class="btn btn-danger" style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem;" 
                            onclick="deleteRecord(${record.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        function getStateText(state) {
            const states = {
                'excellent': 'æä½³',
                'good': 'è‰¯å¥½',
                'normal': 'ä¸€èˆ¬',
                'tired': 'ç–²åŠ³',
                'stressed': 'å‹åŠ›å¤§'
            };
            return states[state] || state;
        }

        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                healthData.records = healthData.records.filter(record => record.id !== id);
                updateStats();
                updateHistory();
            }
        }

        function filterHistory() {
            const filterDate = document.getElementById('filterDate').value;
            if (!filterDate) {
                updateHistory();
                return;
            }

            const filteredRecords = healthData.records.filter(record =>
                record.dateTime.startsWith(filterDate)
            );

            const historyList = document.getElementById('historyList');
            if (filteredRecords.length === 0) {
                historyList.innerHTML = '<p>è¯¥æ—¥æœŸæ— è®°å½•</p>';
                return;
            }

            historyList.innerHTML = filteredRecords.map(record => `
                <div class="history-item">
                    <div class="date">${new Date(record.dateTime).toLocaleString('zh-CN')}</div>
                    <div>æŒç»­æ—¶é—´ï¼š${record.duration}åˆ†é’Ÿ | å¿ƒæƒ…ï¼š${record.mood}/10 | çŠ¶æ€ï¼š${getStateText(record.physicalState)}</div>
                    ${record.notes ? `<div class="note">${record.notes}</div>` : ''}
                </div>
            `).join('');
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                healthData.records = [];
                updateStats();
                updateHistory();
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤');
            }
        }

        function setReminder() {
            const frequencyReminder = document.getElementById('frequencyReminder').value;
            const reminderTime = document.getElementById('reminderTime').value;

            healthData.settings.frequencyReminder = frequencyReminder;
            healthData.settings.reminderTime = reminderTime;

            updateReminders();
            alert('æé†’è®¾ç½®å·²ä¿å­˜');
        }

        function updateReminders() {
            const container = document.getElementById('currentReminders');
            const { frequencyReminder, reminderTime } = healthData.settings;

            if (frequencyReminder === 'none') {
                container.innerHTML = '<p>æš‚æ— æ´»åŠ¨æé†’</p>';
            } else {
                const frequencyText = {
                    'daily': 'æ¯æ—¥',
                    'weekly': 'æ¯å‘¨',
                    'custom': 'è‡ªå®šä¹‰'
                };

                container.innerHTML = `
                    <p>âœ… ${frequencyText[frequencyReminder]}å¥åº·æ£€æŸ¥æé†’</p>
                    <p>â° æé†’æ—¶é—´ï¼š${reminderTime}</p>
                `;
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(healthData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `health_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    if (importedData.records && Array.isArray(importedData.records)) {
                        healthData = importedData;
                        updateStats();
                        updateHistory();
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                }
            };

            reader.readAsText(file);
        }
    </script>
    <script src="assets/js/app.js"></script>
</body>

</html>